parameters:
- name: generationType
  type: string
  default: deployment
  values:
  - deployment
  - mirroring

steps:
- checkout: rhado
- task: GoTool@0
  displayName: Use Go 1.16.2
  inputs:
    version: 1.16.2
- task: Go@0
  inputs:
    command: custom
    customCommand: run
    arguments: . {{ parameters.generationType }}
    workingDirectory: $(Build.SourcesDirectory)/ARO.Pipelines/ev2/generator/
  displayName: ⚙️ Generate Ev2 Deployment Manifests for {{ parameters.generationType }}
${{ if eq(parameters.generationType, 'deployment') }}:
- task: Bash@3
  displayName: ⚙️ Copy to ob_outputDirectory
  inputs:
    targetType: filePath
    filePath: .pipelines/onebranch/scripts/deploymentpipeline.sh
${{ if eq(parameters.generationType, 'mirroring') }}:
- task: Bash@3
  displayName: ⚙️ Copy to ob_outputDirectory
  inputs:
    targetType: filePath
    filePath: .pipelines/onebranch/scripts/mirrorpipeline.sh
