parameters:
- name: tdAgentVersion
  displayName: TD Agent Version
  type: string

steps:
- task: onebranch.pipeline.imagebuildinfo@1
  displayName: Build Fluentbit ${{ parameters.tdAgentVersion }}
  inputs:
    repositoryName: fluentbit
    dockerFileRelPath: ./Dockerfile.fluentbit
    dockerFileContextPath: ./
    registry: cdpxlinux.azurecr.io
    saveImageToPath: fluentbit.tar
    buildkit: 1
    enable_network: true
    build_tag: ${{ parameters.tdAgentVersion }}
    arguments: ' --build-arg VERSION=${{ parameters.tdAgentVersion }}'
